\chapter{Wprowadzenie}
\label{t:wprowadzenie}

	%	\subsection{Opis zagadnienia}
	%	\subsection{Zastosowania}
	%	\subsection{Problemy}
	
	Szybki rozwój technologiczny i wydajnościowy sprzętu komputerowego zazwyczaj idzie w~parze z~pojawianiem się coraz większej liczby jego zastosowań. Twórcy wizualizacji graficznych oraz gier komputerowych ciągle próbują jak najwierniej oddać wirtualne środowisko wraz ze wszystkimi jego elementami. Wśród nich znajdują się także różnego rodzaju obiekty złożone z~materiałów tekstylnych, na przykład ubrania postaci, dywany, gobeliny czy sztandary. Realistyczna animacja ich ruchu oraz interakcji z~pozostałymi obiektami, charakterystyczne zmarszczki i~zagięcia stanowią dodatek bardzo istotny w~zwiększaniu autentyczności wirtualnej sceny. 
	
	Jednakże ręczne tworzenie tej dynamiki przez animatora to bardzo trudne i~zazwyczaj nie odznaczające się satysfakcjonującymi efektami zajęcie. W związku z~tym zaproponowano modele symulacji dynamiki tkanin, gdzie położenie wyznaczonych punktów masy ubrania czy materiału jest obliczane w czasie rzeczywistym. Niestety, koszt obliczeniowy cechuje szybki wzrost wraz ze zwiększaniem dokładności. Rozwiązanie to przeprowadzanie obliczeń przy użyciu kart graficznych -- GPU, jako że przesunięcia poszczególnych wierzchołków siatki wielokątowej tkaniny można obliczać niezależnie od siebie, a~wieloprocesorowe urządzenie komputera PC idealnie się do tego nadaje.
	
	Od dłuższego czasu urządzenia mobilne także zaczęto wyposażać w~wyspecjalizowane układy GPU. Głównym zadaniem niniejszej pracy jest sprawdzenie, czy także i~one wydajnościowo podołają zadaniu zasymulowania ruchu tkaniny oraz jej reagowania z~otoczeniem.
		
	\section{Cel pracy}
	\label{t:wprowadzenie:cel}
	
	Symulacja tkanin to zagadnienie, z~którego dopracowaniem już od dawna boryka się wielu ekspertów. Skutkiem jest istnienie kilku różnych rozwiązań tego problemu, każde ma swoje wady i~zalety. Niniejsza praca postawiła sobie za cel zaimplementowanie dwóch metod symulacji -- modelu masy na sprężynie i~opartego na pozycji. Pierwszy z~nich cechuje prostota koncepcyjna, drugi -- wydajność, elastyczność i~odporność na błędy numeryczne. Dokonane zostanie porównanie pod względem szybkości działania, stabilności oraz, subiektywnie, wierności odwzorowania rzeczywistego zachowania tkaniny.
	
	Drugim kluczowym elementem niniejszej pracy jest wykorzystanie GPU do przeprowadzenia obliczeń, ponieważ teoretycznie charakteryzują się one dużo większą wydajnością dla zagadnień mogących być przetwarzanymi równolegle. Bez wątpienia taka tendencja istnieje na platformie PC, gdzie prym wiodą wysokowydajne karty graficzne. Co w~takim razie z~coraz bardziej popularnymi urządzeniami mobilnymi? Instalowane tam układy GPU nie cechuje duża szybkość, a~raczej niski pobór energii i~mały rozmiar. Czy także tutaj uzyskają przewagę wydajnościową nad procesorami CPU? Na przykładzie symulacji tkanin postarano się w~niniejszej pracy na to pytanie odpowiedzieć, implementując trzy różne wersje symulatora -- z~użyciem GPU, sekwencyjnie na CPU oraz wielowątkowo na CPU. Następnie porównano wydajność ich pracy dla zbiorów danych o~różnej wielkości, co pozwala dowiedzieć się, czy faktycznie wykorzystanie kart graficznych urządzeń mobilnych do obliczeń GPGPU ma sens.
	
	Ostatnią kwestią była także chęć pokazania dokładnych różnic między platformami PC oraz mobilną. Stworzona została osobna wersja programu na każdą z~nich tak, aby współdzieliły ze sobą jak największą część kodu i~działały możliwie identycznie. Wyciągając wnioski z~implementacji oraz testowania obu, można ocenić dokładną przewagę wydajnościową tej pierwszej, a~także omówić unikalne możliwości interakcji z~użytkownikiem drugiej, zwracając jednak uwagę na występujące tu ograniczenia sprzętowe i~programowe. 
	
	\section{Założenia}
	\label{t:wprowadzenie:zalozenia}
	
	Została stworzona aplikacja prezentująca symulację tkanin z~użyciem dwóch różnych metod, jej kolizje z~obiektami wirtualnej sceny oraz reakcje na interakcję użytkownika. W~skład prezentowanej sceny, oprócz symulowanej tkaniny wchodzą płaska podłoga oraz przedmiot kolizyjny reprezentowany przez sferę bądź prostopadłościan. Użytkownik wpływa na zachowanie tkaniny, przesuwając ten obiekt przy pomocy przycisków, bądź wykonując ruchy palcem po ekranie dotykowym. Ponadto istnieje możliwość zmiany różnych parametrów, takich jak model symulacyjny, gęstość siatki czy współczynnik sztywności. Da się także ustawić, czy symulacja będzie przetwarzana przez procesor, czy kartę graficzną. Sam program występuje w~wersjach na dwie różne platformy -- mobilną i~PC, reprezentowane odpowiednio przez systemy operacyjne Android oraz Windows. Urządzenia testowe to smartfon LG Nexus 4 i~średniej klasy komputer PC.
	
	Założeniami pracy były także, w~miarę możliwości, stworzenie samemu całego silnika, w~którym można osadzić symulację oraz osiągnięcie jak największej wydajności. W~związku z~tym zdecydowano się na użycie natywnych bibliotek Androida -- Android NDK i~API graficznego OpenGL ES 3.0, zapewniających szczegółową kontrolę nad działaniem aplikacji, a~także dużą szybkość przetwarzania. Chcąc mieć jak najlepsze porównanie, na platformie Windows użyto w~tym celu OpenGL w~starszej już dziś wersji 3.3, z~racji tego iż zbiorem funkcji odpowiada ona edycji ES 3.0.
	
	\section{Zakres pracy}
	\label{t:wprowadzenie:zakres}
	
	Aby Czytelnik nie miał problemów ze zrozumieniem całości zagadnienia, rozdział 2 zawiera w~sobie całą wiedzę teoretyczną dotyczącą omawianych dziedzin. Przedstawione zostaną koncepcyjne i~matematyczne podstawy obu modeli symulacji tkanin oraz system detekcji jej kolizji z~otoczeniem i~samą sobą, wraz z~odpowiednimi niezbędnymi strukturami kolizyjnymi. Następnie zwrócona jest uwaga na problematykę programowania ogólnego przeznaczenia na GPU (GPGPU), które cechuje inne podejście, niż klasyczne sekwencyjne, omówiona zostanie architektura przykładowego GPU wraz ze strukturą oraz kolejnością wykonywanych na nim działań. Jako przykłady podane zostaną technologia CUDA oraz klasyczny potok renderingu, którego część także można wykorzystać do GPGPU. Na koniec porównano architektury, wydajności i~charakterystyczne cechy CPU oraz GPU ze wskazaniem kluczowych różnic oraz omówiono, jak wykorzystanie GPU w symulacji tkanin pozwala przyspieszyć proces obliczeniowy.
	
	Rozdział 3 skupia się na wykorzystanych w~niniejszej pracy technologiach. Dokonano analizy możliwości urządzeń mobilnych w~kwestii GPGPU, zastanawiając się nad sensownością ich użycia do wspomnianych zastosowań, scharakteryzowano urządzenie testowe i~porównano je z~przykładową konfiguracją PC. Skupiono się także na przewagach platformy mobilnej, omawiając jej unikalne możliwości interakcji oraz dostępność. Następnie opisane zostały wszystkie użyte na potrzeby pracy technologie programistyczne -- API, biblioteki, kluczowe funkcje oraz środowisko programowania.
	
	W~rozdziale 4 zaprezentowano architekturę autorskiego silnika aplikacji, w~którym osadzono symulator tkanin. Przedstawiono wszystkie najważniejsze komponenty, każdy pokrótce scharakteryzowano, zwrócono także uwagę na połączenia między nimi. Kluczowym dla zrozumienia działania programu elementem są tu diagramy klas oraz ogólne algorytmy pracy silnika. Następnie skupiono się na modelu encji systemu, zaprojektowanym z myślą o złożeniu każdej z poszczególnych komponentów. Ważną omawianą kwestią jest także komunikacja aplikacji z~systemem Android, czyli obsługa zdarzeń. Na koniec opisano, wraz z~podaniem odpowiednich algorytmów, proces renderingu poszczególnych obiektów 3D oraz scharakteryzowano system interfejsu użytkownika, zwracając uwagę zarówno na to, co da się z~jego pomocą stworzyć, jak i~na to, co w~efekcie użytkownik może robić w~programie.
	
	W rozdziale 5 skupiono się wyłącznie na samym symulatorze tkanin. Zebrano w~jedną całość wszystkie poczynione założenia projektowe, omówiono je i~następnie pokazano, jak zostały one zrealizowane. Podano algorytmy działania symulatora w~każdej z~trzech implementacji, opisano wszystkie parametry biorące udział w~symulacji oraz ich wpływ na jej wyniki. Sam ten proces podzielono na trzy etapy, każdy z nich dokładnie scharakteryzowano, załączono też fragmenty kodu GLSL, uruchamianego na karcie graficznej.
	
	Rozdział 6 zawiera wyniki działania symulatora tkanin. Zebrano je w~trzech kategoriach. Czas wykonania obrazują tabele oraz wykres, gdzie ukazana została jej zależność od gęstości symulowanej siatki dla każdej z~implementacji. Podobnie wygląda sytuacja w~kwestii stabilności, gdzie jako miarę przyjęto średnie oscylacje przykładowego wierzchołka, w~zależności od współczynnika sztywności. Ostatnie kryterium -- efekt wizualny obrazują zrzuty ekranu wykonane dla różnych metod oraz parametrów, dających pełne spektrum tego, co można uzyskać przy pomocy symulatora. 
	
	Wyniki pozwalają wyciągnąć wnioski na temat przewagi jednej metody, bądź implementacji, nad drugą. Właśnie tego dokonano w~rozdziale 7, będącym podsumowaniem pracy. Przy użyciu danych z~rozdziału 6, przeprowadzono porównanie metod masy na sprężynie i~opartej na pozycji, implementacji CPU oraz GPU, zwracając uwagę na ich wady, zalety, wymieniając możliwe zastosowania oraz mówiąc, co można poprawić, by uzyskać lepszy efekt. Porównano także implementacje na różnych platformach -- Windows oraz Android, głównie pod kątem wydajności, oraz finalnie zastanowiono się nad sensownością wykorzystania oraz praktycznymi możliwościami tej drugiej w~kwestii symulacji tkanin.